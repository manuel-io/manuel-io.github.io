<!DOCTYPE html> <!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]--> <!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]--> <!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html manifest="cache.manifest" class="no-js" lang="en"><!--<![endif]--> <head> <meta charset="utf-8"> <title>DLNA/UPnP Debugging - A personal Blog</title> <meta name="author" content="Manuel"> <meta name="keywords" content="2015, upnp, dlna, minidlna, administration"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="apple-touch-icon" href="/style/touch-icon.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/style/touch-icon.png"> <link rel="canonical" href="https://manuel-io.github.io/blog/2015/09/20/dlna-slash-upnp-debugging"> <link rel="shortcut icon" type="image/png" href="/favicon.png"> <link href="/stylesheets/screen.css" media="all" rel="stylesheet" type="text/css"> <link href="/atom.xml" rel="alternate" title="A personal Blog" type="application/atom+xml"> <script src="/javascripts/libs/jquery-1.11.2.min.js" type="text/javascript"></script> <script src="/javascripts/blog.js" type="text/javascript"></script> <script type="text/javascript" src="/javascripts/mathjax/unpacked/MathJax.js?config=TeX-AMS_HTML"></script> <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "jax": ["input/TeX", "output/HTML-CSS"],
    styles: { ".MathJax_Display": { "text-align": "left" } },
    "tex2jax": {
      inlineMath: [ ['$', '$'], ["\\(", "\\)"] ],
      displayMath: [ ['$$', '$$'], ["\\[", "\\]"] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: { autoNumber: "AMS" },
      TagSide: "left"
    },
    "HTML-CSS": {
      availableFonts: ["TeX"],
      linebreaks: { automatic: true }
    }
  });
</script> </head> <body> <header class='site'><h1> <a href="/"> <p>A</p> <p> </p> <p>p</p> <p>e</p> <p>r</p> <p>s</p> <p>o</p> <p>n</p> <p>a</p> <p>l</p> <p> </p> <p>B</p> <p>l</p> <p>o</p> <p>g</p> </a> </h1> </header> <div style='clear:both;'></div> <nav><span><a href="/">Blog</a></span> <span><a href="/blog/photography">Photography</a></span> <span><a href="http://vkitchen.herokuapp.com" target="_blank">Kitchen</a></span> <span><a href="https://github.com/manuel-io" target="_blank">Github</a></span> <span><a href="https://de.wikipedia.org/wiki/Benutzer:Manuel_Bieling" target="_blank">Wikipedia</a></span> <span><a href="/blog/links">Links</a></span> <span><a href="/atom.xml">Feed</a></span> <span><a href="/blog/tags">Tags</a></span> <span><a href="/blog/archives">Archive</a></span> <span><a href="/blog/about">About</a></span> </nav> <article> <header class='post'> <h1 class="entry-title">DLNA/UPnP Debugging</h1> <p> <time class='entry-date' datetime='2015-09-20T19:00:30+02:00'><span class='date'>Sep, 2015-09-20 | </span> <span class='time'>Sun, 19:00 </span></time> </p> </header> <section><p>Die Tage habe ich einen Medien-Server (<a href="http://sourceforge.net/projects/minidlna/">miniDLNA</a>) aufgesetzt. Im Prinzip kein Problem. Nur die Firewall musste ich zusätzlich konfigurieren. Tcpdump und dieser <a href="http://www.upnp-hacks.org/upnp.html">Artikel</a> waren dabei hilfreich. Etwa:</p> <pre><code>sudo tcpdump -i wlan0 udp port 1900 -vv -X
</code></pre> <h3>Topografie</h3> <p>Server und Player befinden sich in einem Netzwerk <em>192.168.2.0/16</em>. Server (<em>192.168.2.102</em>), Player (<em>192.168.2.106</em>).</p> <h3>Discover</h3> <p>Zunächst sendet der Player (Client) ein UDP Paket an eine multicast Adresse: <code>192.168.2.106:39250 &gt; 239.255.255.250:1900</code>. Der Quellport ist beliebig, der Zielport ist <em>1900</em>.</p> <pre><code>M-SEARCH * HTTP/1.1
MX: 3
ST: ssdp:all
HOST: 239.255.255.250:1900
MAN: ssdp:discover
</code></pre> <p>Die Antwort von einem UPnP-Server geht von Port <em>1900</em> an Ursprungsadresse und Port <code>192.168.2.102:1900 &gt; 192.168.2.106:39250</code>:</p> <pre><code>HTTP/1.1 200 OK
CACHE-CONTROL: max-age=1210
DATE: Sun, 20 Sep 2015 17:04:12 GMT
ST: urn:microsoft.com:service:X_MS_MediaReceiverRegistrar:1
USN: uuid:4d696e69-444c-164e-9d41-f0def14a0058::urn:microsoft.com:service:X_MS_MediaReceiverRegistrar:1
EXT:
SERVER: 3.2.0-61-generic.DLNADOC/1.50 UPnP/1.0 MiniDLNA/1.1.2
LOCATION: http://192.168.2.102:8200/rootDesc.xml
Content-Length: 0
</code></pre> <p>Damit teilt der Server sein Vorhandensein mit und gibt weitere Informationen. Die URL in der Antwort (unter LOCATION) kann im Browser geöffnet werden:</p> <p><code>curl -I http://192.168.2.102:8200/rootDesc.xml</code>.</p> <pre><code>HTTP/1.1 200 OK
Content-Type: text/xml; charset="utf-8"
Connection: close
Content-Length: 2204
Server: 3.2.0-61-generic DLNADOC/1.50 UPnP/1.0 MiniDLNA/1.1.2
Date: Sun, 20 Sep 2015 17:48:56 GMT
EXT:
</code></pre> <p>Für mich bedeutet das zusätzliche Regeln in der Firewall für den Server:</p> <pre><code>-A INPUT -p tcp -m tcp -s 192.168.0.0/16 -m state --state NEW,ESTABLISHED --dport 8200 -j ACCEPT
-A OUTPUT -p tcp -d 192.168.0.0/16 -m state --state ESTABLISHED --sport 8200 -j ACCEPT

-A INPUT -p udp -s 192.168.0.0/16 -d 239.255.255.250 --dport 1900 -j ACCEPT
-A OUTPUT -p udp -s 192.168.0.0/16 -d 192.168.0.0/16 --sport 1900 -j ACCEPT
</code></pre> <p>Und für den Player (Client):</p> <pre><code>-A INPUT -p tcp -m tcp -s 192.168.0.0/16 -d 192.168.0.0/16 -m state --state ESTABLISHED --sport 8200 -j ACCEPT
-A OUTPUT -p tcp -s 192.168.0.0/16 -d 192.168.0.0/16 -m state --state NEW,ESTABLISHED --dport 8200 -j ACCEPT

-A INPUT -p udp -s 192.168.0.0/16 -d 192.168.0.0/16 --sport 1900 -j ACCEPT
-A OUTPUT -p udp -s 192.168.0.0/16 -d 239.255.255.250 --dport 1900 -j ACCEPT
</code></pre> <p>Dass müsste gehen. Es kann sein, dass der Server noch einige Fehlermeldungen wirft: <code>error: sendto(udp_notify=8, 192.168.2.102): Operation not permitted</code>. Dann hilft es die Firewallregeln des Players zusätzlich dem Server zu geben&ndash;der Server ist auch ein Client. Es müsste aber auch einfach so gehen.</p> </section> <div style='clear:both;'></div> <footer> <section class="meta"> <p> <span class="byline author vcard">Posted by <span class="fn">Manuel</span></span> </p> <p class='categories'> <a class='category' href='/blog/categories/2015/'>2015</a>, <a class='category' href='/blog/categories/administration/'>administration</a>, <a class='category' href='/blog/categories/dlna/'>dlna</a>, <a class='category' href='/blog/categories/minidlna/'>minidlna</a>, <a class='category' href='/blog/categories/upnp/'>upnp</a> </p> </section> <section class='pagination'> <table><tr> <th class='left'><p><a href="/blog/2015/09/08/von-der-gebuhr-zum-beitrag/" title="Previous Post: Von der Gebühr zum Beitrag">&laquo; </a></p></th> <td class='left'><p><a href="/blog/2015/09/08/von-der-gebuhr-zum-beitrag/" title="Previous Post: Von der Gebühr zum Beitrag">Von der Gebühr zum Beitrag</a></p></td> <td class='right'><p><a href="/blog/2015/11/05/filzlinge/" title="Next Post: Filzlinge">Filzlinge</a></p></td> <th class='right'><p><a href="/blog/2015/11/05/filzlinge/" title="Next Post: Filzlinge"> &raquo;</a></p></th> </tr></table> </section> </footer> </article> <footer><section class='posts'> <ul> <li><a href="/blog/2019/04/14/base2/">1. Base ∈ {2, 10}</a></li> <li><a href="/blog/2019/03/02/css-animation-101/">2. CSS Animation 101</a></li> <li><a href="/blog/2019/02/03/driving-batteries-in-parallel/">3. Driving Batteries in Parallel</a></li> <li><a href="/blog/2018/12/31/vegane-rezepte-2018/">4. Vegane Rezepte 2018</a></li> <li><a href="/blog/2018/12/24/zyklische-redundanzprufung/">5. Zyklische Redundanzprüfung (Theorie)</a></li> </ul> </section> <section class='copyright'> <p> Copyright &copy; 2010-2019 | Manuel | <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> </p> </section> </footer> </body> </html>